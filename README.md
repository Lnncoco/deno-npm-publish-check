# deno-npm-publish-check ğŸ¦•

NPM æ¨¡å—å‘åŒ…æ£€æµ‹å·¥å…·

ç¨‹åºä¼šæŒ‰é…ç½®å¥½çš„åœ°å€è¯»å– `package.json` æ–‡ä»¶ä¿¡æ¯ï¼Œå¹¶é€šè¿‡å…¶ä¸­çš„ `publishConfig` é…ç½®åœ°å€æ‹¼æ¥åŒ…åæŸ¥è¯¢å‘åŒ…çš„ä¿¡æ¯ã€‚ç„¶åå¯¹æ¯”ç‰ˆæœ¬å·ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬å·®å¼‚ã€‚

ç‰ˆæœ¬å·è¯´æ˜ï¼š
ç‰ˆæœ¬å·éœ€è¦éµå¾ª [semver](https://semver.org/lang/zh-CN/) è§„èŒƒï¼Œä¼šæŒ‰ä½ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·ã€ä¿®è®¢å·çš„é¡ºåºæ¯”å¯¹ï¼Œä¹‹åå†æ¯”å¯¹å…ˆè¡Œç‰ˆæœ¬å·ã€‚å¦‚æœå…ˆè¡Œç‰ˆæœ¬å·ä¸­æ˜¯æ•°å­—ï¼Œåˆ™åŒæ ·æŒ‰é¡ºåºæ¯”å¯¹ç‰ˆæœ¬å¤§å°ï¼Œéæ•°å­—åˆ™ä»…æ¯”å¯¹å­—ç¬¦ä¸²æ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´è§†ä¸ºç‰ˆæœ¬å·æ— æ³•æ¯”å¯¹ã€‚

## ä½¿ç”¨è¯´æ˜

### æºç è¿è¡Œï¼ˆéœ€è¦å®‰è£… denoï¼‰

```
deno run --allow-net --allow-read --allow-write --unstable main.ts check
```

![check](./check.gif)

### Trex

å¦‚æœå®‰è£…äº† `Trex` å¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤

```
trex run check
```

### ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶

```
deno compile --allow-net --allow-read --allow-write --unstable --target x86_64-pc-windows-msvc main.ts
```

> --target å‚æ•°: x86_64-unknown-linux-gnu, x86_64-pc-windows-msvc, x86_64-apple-darwin, aarch64-apple-darwin

å¯ä»¥ä½¿ç”¨äº¤å‰ç¼–è¯‘åˆ†å‘å…¶ä»–å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

### å¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œ

```
npm-publish-check check
```

### å¸¸ç”¨å‘½ä»¤

```
   -h, --help                   å¸®åŠ©æ–‡æ¡£
   -c, --config <FILE>          æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ (é»˜è®¤./config.ts)
   -j, --jenkins <true|false>   æ˜¯å¦è§¦å‘Jenkinsæ›´æ–° (é»˜è®¤false)
   -t, --tags <TAG>             æ£€æŸ¥æŒ‡å®šçš„tagç‰ˆæœ¬ä¿¡æ¯
   -v, --verison                æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
   --on-error                   æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
   init                         ç”Ÿæˆé»˜è®¤çš„config.tsé…ç½®æ–‡ä»¶
   --name                       é…åˆinitæŒ‡å®šç”Ÿæˆæ–‡ä»¶å
   check                        æŒ‰é…ç½®æ–‡ä»¶æ£€æŸ¥ä»“åº“ä¸­çš„åŒ…ä¿¡æ¯
```

## é…ç½®æ–‡ä»¶è¯´æ˜

é»˜è®¤è¯»å–åŒç›®å½•ä¸‹çš„ `config.jsonc` æ–‡ä»¶ï¼Œæ–‡ä»¶æ ¼å¼éœ€è¦ç¬¦åˆ `jsonc` è§„èŒƒã€‚  
ä½¿ç”¨ `init` å‘½ä»¤å¯ä»¥åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆå‚è€ƒçš„é…ç½®æ–‡ä»¶ã€‚  
ä½¿ç”¨ `-c <FILE>` å‘½ä»¤è¿è¡ŒæŒ‡å®šç›®å½•çš„é…ç½®æ–‡ä»¶ã€‚  
ä½¿ç”¨ `-t <TAG>` ä¸´æ—¶æŸ¥è¯¢æŒ‡å®š tag çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œç¨‹åºå°†ä¸ä¼šæŒ‰é…ç½®æ–‡ä»¶ä¸­çš„ `checkTags` æŸ¥è¯¢ã€‚

```
export interface CONFIG {
  /**
   * éœ€è¦æ£€æµ‹çš„ tag åç§°
   */
  checkTags: checkTags;
  /**
   * å…¨å±€çš„gité…ç½®
   */
  git: {
    cookie: string;
    cookiePath?: string; // cookieçš„å­˜æ”¾æ–‡ä»¶ å­˜åœ¨cookieä¼˜å…ˆä½¿ç”¨cookieå­—æ®µ
    template?: string; // å…¨å±€ urlæ¨¡æ¿  ä½¿ç”¨ {{}} {{=}} ç¬¦å·å®šä¹‰æ›¿æ¢å˜é‡å
    checkLoginURL?: string; // ç™»å½•é¡µçš„è·¯å¾„
  }
  /**
   * å…¨å±€é»˜è®¤JenkinsæŸ¥è¯¢é…ç½®
   * å¯é€‰é¡¹
   */
  jenkins: {
    /**
      * å…¨å±€ Jenkins cookie
      */
    cookie?: string;
    /**
     * å…¨å±€ Jenkins cookie çš„å­˜æ”¾æ–‡ä»¶ å­˜åœ¨cookieä¼˜å…ˆä½¿ç”¨cookieå­—æ®µ
     */
    cookiePath?: string;
    /**
      * å…¨å±€ urlæ¨¡æ¿
      * ä½¿ç”¨ {{}} ç¬¦å·å®šä¹‰æ›¿æ¢å˜é‡å
      * ä½¿ç”¨ {{=}} ç¬¦å·æ‹¼æ¥å¸¦å˜é‡åçš„å‚æ•° å¦‚{{=cause}}æ›¿æ¢ä¸ºcause=å‚æ•°å€¼
      */
    template?: string;
    /**
      * å…¨å±€ Jenkins token
      * æ‹¼æ¥åœ¨è®¿é—®çš„urlä¹‹å ?token=token
      */
    token?: string;
    /**
      * å…¨å±€ Jenkins causeå‚æ•°å€¼
      * æ‹¼æ¥åœ¨è®¿é—®çš„urlä¹‹å ?cause=cause
      */
    cause?: string;
  };
  /**
   * packageé…ç½®ä¿¡æ¯
   */
  package: {
    /**
     * key ä¸ºåŒ…å
     */
    [key: string]: {
      /**
       * key ä¸ºtagåç§°
       */
      [key: string]: {
        git:
          | URL // Git url  å­˜åœ¨å±€éƒ¨urlä¼˜å…ˆä½¿ç”¨url æ— æ³•ä½¿ç”¨å˜é‡
          | {
              /**
               * æ¨¡æ¿ä½¿ç”¨å˜é‡
               * å…¶å€¼ä¼šæ›¿æ¢æ¨¡æ¿ä¸­ç›¸åŒåç§°çš„å˜é‡
               */
              [key: string]: string | undefined;
            };
        jenkins?: {
          /**
           * å±€éƒ¨ Jenkins cookie
           */
          cookie?: string;
          /**
           * Jenkins url
           * å­˜åœ¨å±€éƒ¨urlä¼˜å…ˆä½¿ç”¨url æ— æ³•ä½¿ç”¨å˜é‡
           * å½“å‰å±€éƒ¨é…ç½®ä¸­å­˜åœ¨tokenå­—æ®µåˆ™ä¼šæ‹¼æ¥token,å¦åˆ™å°†å¿½ç•¥å…¨å±€tokené…ç½®,ç›´æ¥è®¿é—®url
           */
          url: string;
          /**
           * æ¨¡æ¿ä½¿ç”¨å˜é‡
           * é™¤äº†ä»¥ä¸Šä¿ç•™å…³é”®å­— å…¶ä½™å€¼ä¼šæ›¿æ¢æ¨¡æ¿ä¸­ç›¸åŒåç§°çš„å˜é‡
           */
          [key: string]: string | undefined;
        };
      };
    };
  };
}
```
